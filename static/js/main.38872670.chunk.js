(this["webpackJsonpincome-cm-narrative"]=this["webpackJsonpincome-cm-narrative"]||[]).push([[0],{107:function(t,e,r){},108:function(t,e,r){},111:function(t,e,r){"use strict";r.r(e);var n=r(3),a=r.n(n),i=r(36),c=r.n(i),s=(r(107),r.p,r(108),r(6)),o=r(7),l=r(2),u=r(8),h=r(9),d=r(4),y=r.n(d),m=r(13),p=r(0),f=r(1),v=function(t){Object(u.a)(r,t);var e=Object(h.a)(r);function r(t){var n;return Object(s.a)(this,r),(n=e.call(this,t)).svgRef=a.a.createRef(),n.state={year:1800,country:"average"},n.cm_plots={},n.income_plots={},n.setyear=n.setyear.bind(Object(l.a)(n)),n.tick=n.tick.bind(Object(l.a)(n)),n.setCurrentYear=n.setCurrentYear.bind(Object(l.a)(n)),n.handleSelect=n.handleSelect.bind(Object(l.a)(n)),n}return Object(o.a)(r,[{key:"updatechart",value:function(){var t=this,e=500;"average"!=this.state.country&&null===this.timerID&&(e=1e3);var r=this.cm_plots[this.state.country].filter((function(e){return e.year<=t.state.year})).sort((function(t,e){return parseFloat(t.year)-parseFloat(e.year)})),n=this.income_plots[this.state.country].filter((function(e){return e.year<=t.state.year})).sort((function(t,e){return parseFloat(t.year)-parseFloat(e.year)})),a=p.g().domain([1800,2040]).range([0,700]),i=p.g().domain([0,e]).range([300,0]),c=p.h().domain([200,179e3]).range([300,0]);p.e().x((function(t){return a(t.year)})).y((function(t){return i(t.val)}));p.i("#scatter").html(""),p.i("#ttip").html("");var s=p.i("#ttip").append("div").attr("class","tooltip").style("opacity",0);this.addpath(r.filter((function(t){return t.year<=2021})),"steelblue",a,i,"translate(50,50)"),this.addpath(r.filter((function(t){return t.year>=2021})),"red",a,i,"translate(50,50)"),this.addtooltips(r,a,i,s,"translate(50,50)"),p.i("#scatter").append("g").attr("transform","translate(50,50)").call(p.b(i).tickFormat(p.d("~s"))),p.i("svg").append("g").attr("transform","translate(50,350)").call(p.a(a)),this.addpath(n.filter((function(t){return t.year<=2021})),"steelblue",a,c,"translate(50,450)"),this.addpath(n.filter((function(t){return t.year>=2021})),"red",a,c,"translate(50,450)"),this.addtooltips(n,a,c,s,"translate(50,450)"),p.i("#scatter").append("g").attr("transform","translate(50,450)").call(p.b(c).tickValues([300,1e3,3e3,1e4,3e4,1e5]).tickFormat(p.d("~s"))),p.i("svg").append("g").attr("transform","translate(50,750)").call(p.a(a))}},{key:"addpath",value:function(t,e,r,n,a){p.i("#scatter").append("g").attr("transform",a).append("path").datum(t).attr("fill","none").attr("stroke",e).attr("stroke-width",1.5).attr("d",p.e().x((function(t){return r(t.year)})).y((function(t){return n(t.val)})))}},{key:"addtooltips",value:function(t,e,r,n,a){p.i("#scatter").append("g").attr("transform",a).selectAll("rect").data(t).enter().append("rect").attr("x",(function(t,r){return e(t.year)})).attr("y",(function(t,e){return 0})).attr("width",(function(t,e){return 1})).attr("height",(function(t,e){return 300})).attr("fill","black").attr("opacity",0).on("mouseover",(function(t,e){p.i(this).attr("opacity",1),n.transition().duration(200).style("opacity",1),n.html(e.year+"<br/>"+e.val).style("left",t.pageX+"px").style("top",t.pageY-28+"px")})).on("mouseout",(function(t,e){p.i(this).attr("opacity",0),n.transition().duration(500).style("opacity",0)}))}},{key:"componentDidMount",value:function(){var t=Object(m.a)(y.a.mark((function t(){var e,r,n=this;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("chart mounted"),t.next=3,p.c("/income-cm-narrative/income_processed.csv");case 3:return this.incomedata=t.sent,t.next=6,p.c("/income-cm-narrative/child_mortality_0_5_year_olds_dying_per_1000_born.csv");case 6:for(this.cm_data=t.sent,this.cm_plots={},this.cm_plots.average=[],this.income_plots={},this.income_plots.average=[],e=function(t){for(var e=n.incomedata.map((function(e){var r=n.cm_data.find((function(t){return t.country===e.country}));return void 0===r||isNaN(e[t])||isNaN(r[t])?null:{country:e.country,income:e[t],child_mortality:r[[t]]}})).filter((function(t){return t.child_mortality>0})),r=0;r<e.length;r++){var a=e[r];a.country in n.cm_plots||(n.cm_plots[a.country]=[],n.income_plots[a.country]=[]),n.cm_plots[a.country].push({year:t,val:a.child_mortality}),n.income_plots[a.country].push({year:t,val:a.income})}var i=function(t,e){return t+parseFloat(e)},c=e.map((function(t){return t.child_mortality})).reduce(i,0);n.cm_plots.average.push({year:t,val:c/e.length});var s=e.map((function(t){return t.income})).reduce(i,0);n.income_plots.average.push({year:t,val:s/e.length})},r=1800;r<2041;r++)e(r);this.updatechart(),this.timerID=setInterval((function(){return n.tick()}),25);case 15:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){console.log("Unmounting"),clearInterval(this.timerID),this.timerID=null,p.i("#scatter").html(""),p.i("#ttip").html("")}},{key:"componentDidUpdate",value:function(){this.updatechart()}},{key:"tick",value:function(){if(this.state.year>=2040)return clearInterval(this.timerID),this.timerID=null,void this.setState((function(t,e){return{country:t.country,year:2040}}));this.setState((function(t,e){return{country:t.country,year:t.year+1}}))}},{key:"setyear",value:function(t){clearInterval(this.timerID),this.timerID=null,this.setState({country:this.state.country,year:t.target.value})}},{key:"setCurrentYear",value:function(){clearInterval(this.timerID),this.timerID=null,this.setState({country:this.state.country,year:2040})}},{key:"handleSelect",value:function(t){this.setState({country:t.target.value,year:this.state.year})}},{key:"render",value:function(){var t=Object.keys(this.cm_plots),e=t.filter((function(t){return"average"!=t})).sort();return t=["average"].concat(e),Object(f.jsxs)("div",{children:[Object(f.jsxs)("form",{children:[Object(f.jsx)("label",{for:"year",children:"Please select a year: "}),Object(f.jsx)("input",{type:"range",min:1800,max:2040,step:1,id:"year",value:this.state.year,onInput:this.setyear}),Object(f.jsx)("output",{name:"selected_year",id:"selected_year",children:this.state.year})]}),null===this.timerID&&Object(f.jsx)("select",{value:this.state.country,onChange:this.handleSelect,children:t.map((function(t){return Object(f.jsx)("option",{value:t,children:t})}))}),Object(f.jsx)("br",{}),Object(f.jsx)("div",{children:Object(f.jsx)("button",{onClick:this.setCurrentYear,children:"Display complete curve"})}),Object(f.jsx)("div",{id:"ttip"}),Object(f.jsx)("svg",{id:"scatter",width:800,height:800,ref:this.svgRef})]})}}]),r}(n.Component),j=function(t){Object(u.a)(r,t);var e=Object(h.a)(r);function r(t){var n;return Object(s.a)(this,r),(n=e.call(this,t)).svgRef=a.a.createRef(),n.state={year:1800},n.setyear=n.setyear.bind(Object(l.a)(n)),n.tick=n.tick.bind(Object(l.a)(n)),n.setCurrentYear=n.setCurrentYear.bind(Object(l.a)(n)),n}return Object(o.a)(r,[{key:"updatechart",value:function(){var t=this,e=this.incomedata.map((function(e){var r=t.cm_data.find((function(t){return t.country===e.country}));return void 0===r||isNaN(e[t.state.year])||isNaN(r[t.state.year])?null:{country:e.country,income:e[t.state.year],child_mortality:r[[t.state.year]]}})).filter((function(t){return t.child_mortality>0})),r=1e3,n=1.5;null===this.timerID&&(2021==this.state.year&&(r=150),n=3);var a=p.h().domain([200,179e3]).range([0,700]),i=p.g().domain([0,r]).range([700,0]);p.i("#scatter").html(""),p.i("#ttip").html("");var c=p.i("#ttip").append("div").attr("class","tooltip").style("opacity",0);p.i("#scatter").append("g").attr("transform","translate(50,50)").selectAll("circle").data(e).enter().append("circle").attr("cx",(function(t,e){return a(t.income)})).attr("cy",(function(t,e){return i(t.child_mortality)})).attr("r",(function(t,e){return n})).attr("fill","lightblue").on("mouseover",(function(t,e){c.transition().duration(200).style("opacity",1),c.html(e.country+"<br/>"+e.income+"<br/>"+e.child_mortality).style("left",t.pageX+"px").style("top",t.pageY-28+"px")})).on("mouseout",(function(t){c.transition().duration(500).style("opacity",0)})),p.i("#scatter").append("g").attr("transform","translate(50,50)").call(p.b(i).tickFormat(p.d("~s"))),p.i("svg").append("g").attr("transform","translate(50,750)").call(p.a(a).tickValues([300,1e3,3e3,1e4,3e4,1e5]).tickFormat(p.d("~s")))}},{key:"componentDidMount",value:function(){var t=Object(m.a)(y.a.mark((function t(){var e=this;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("/income-cm-narrative"),t.next=3,p.c("/income-cm-narrative/income_processed.csv");case 3:return this.incomedata=t.sent,t.next=6,p.c("/income-cm-narrative/child_mortality_0_5_year_olds_dying_per_1000_born.csv");case 6:this.cm_data=t.sent,this.updatechart(),this.timerID=setInterval((function(){return e.tick()}),25);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){console.log("Unmounting"),clearInterval(this.timerID),this.timerID=null,p.i("#scatter").html(""),p.i("#ttip").html("")}},{key:"componentDidUpdate",value:function(){this.updatechart()}},{key:"tick",value:function(){if(this.state.year>=2040)return clearInterval(this.timerID),this.timerID=null,void this.setState((function(t,e){return{year:2021}}));this.setState((function(t,e){return{year:t.year+1}}))}},{key:"setyear",value:function(t){clearInterval(this.timerID),this.timerID=null,this.setState({year:t.target.value})}},{key:"setCurrentYear",value:function(){clearInterval(this.timerID),this.timerID=null,this.setState({year:2021})}},{key:"render",value:function(){return Object(f.jsxs)("div",{children:[Object(f.jsxs)("form",{children:[Object(f.jsx)("label",{for:"year",children:"Please select a year: "}),Object(f.jsx)("input",{type:"range",min:1800,max:2040,step:1,id:"year",value:this.state.year,onInput:this.setyear}),Object(f.jsx)("output",{name:"selected_year",id:"selected_year",children:this.state.year})]}),Object(f.jsx)("br",{}),Object(f.jsx)("div",{children:Object(f.jsx)("button",{onClick:this.setCurrentYear,children:"Show 2021 data"})}),Object(f.jsx)("div",{id:"ttip"}),Object(f.jsx)("svg",{id:"scatter",width:800,height:800,ref:this.svgRef})]})}}]),r}(n.Component),b=r(37),g=function(t){Object(u.a)(r,t);var e=Object(h.a)(r);function r(t){var n;return Object(s.a)(this,r),(n=e.call(this,t)).svgRef=a.a.createRef(),n.state={year:1800},n.setyear=n.setyear.bind(Object(l.a)(n)),n.tick=n.tick.bind(Object(l.a)(n)),n.setCurrentYear=n.setCurrentYear.bind(Object(l.a)(n)),n}return Object(o.a)(r,[{key:"updatechart",value:function(){var t=this,e=500;2021==this.state.year&&null===this.timerID&&(e=70);for(var r=this.incomedata.map((function(e){var r=t.cm_data.find((function(t){return t.country===e.country}));return void 0===r||isNaN(e[t.state.year])||isNaN(r[t.state.year])?null:{country:e.country,income:e[t.state.year],child_mortality:r[[t.state.year]]}})).filter((function(t){return t.child_mortality>0})),n=r.sort((function(t,e){return parseFloat(t.income)-parseFloat(e.income)})).length,a=Math.floor(n/10),i={},c=0;c<10;c++)i[c]=[];for(var s=0;s<n;s++){var o=Math.floor(s/a);i[o=Math.min(o,9)].push(r[s])}for(var l=[],u=function(t,e){return t+parseFloat(e)},h=0;h<10;h++){var d=i[h],y=d.length,m=d.map((function(t){return t.child_mortality})).reduce(u,0),f=d.map((function(t){return t.income})).reduce(u,0);l.push({cm_avg:m/y,income_avg:f/y})}var v=p.f().domain(Object(b.a)(Array(10).keys())).range([0,700]).paddingInner(.2).paddingOuter(.2),j=p.g().domain([0,e]).range([700,0]);p.h().domain([200,179e3]).range([300,0]);p.i("#scatter").html(""),p.i("#ttip").html("");var g=p.i("#ttip").append("div").attr("class","tooltip").style("opacity",0);p.i("#scatter").append("g").attr("transform","translate(50,50)").selectAll("rect").data(l).enter().append("rect").attr("x",(function(t,e){return v(e)})).attr("y",(function(t,e){return j(t.cm_avg)})).attr("width",(function(t,e){return v.bandwidth()})).attr("height",(function(t,e){return 700-j(t.cm_avg)})).attr("fill",(function(t,e){return t.year>2021?"red":"lightblue"})).on("mouseover",(function(t,e){g.transition().duration(200).style("opacity",1),g.html("Average Income: "+e.income_avg+"<br/>"+e.cm_avg).style("left",t.pageX+"px").style("top",t.pageY-28+"px")})).on("mouseout",(function(t){g.transition().duration(500).style("opacity",0)})),p.i("#scatter").append("g").attr("transform","translate(50,50)").call(p.b(j).tickFormat(p.d("~s"))),p.i("svg").append("g").attr("transform","translate(50,750)").call(p.a(v))}},{key:"componentDidMount",value:function(){var t=Object(m.a)(y.a.mark((function t(){var e=this;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("chart mounted"),t.next=3,p.c("/income-cm-narrative/income_processed.csv");case 3:return this.incomedata=t.sent,t.next=6,p.c("/income-cm-narrative/child_mortality_0_5_year_olds_dying_per_1000_born.csv");case 6:this.cm_data=t.sent,this.updatechart(),this.timerID=setInterval((function(){return e.tick()}),25);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){console.log("Unmounting"),clearInterval(this.timerID),this.timerID=null,p.i("#scatter").html(""),p.i("#ttip").html("")}},{key:"componentDidUpdate",value:function(){this.updatechart()}},{key:"tick",value:function(){if(this.state.year>=2040)return clearInterval(this.timerID),this.timerID=null,void this.setState((function(t,e){return{year:2021}}));this.setState((function(t,e){return{year:t.year+1}}))}},{key:"setyear",value:function(t){clearInterval(this.timerID),this.timerID=null,this.setState({year:t.target.value})}},{key:"setCurrentYear",value:function(){clearInterval(this.timerID),this.timerID=null,this.setState({year:2021})}},{key:"render",value:function(){return Object(f.jsxs)("div",{children:[Object(f.jsxs)("form",{children:[Object(f.jsx)("label",{for:"year",children:"Please select a year: "}),Object(f.jsx)("input",{type:"range",min:1800,max:2040,step:1,id:"year",value:this.state.year,onInput:this.setyear}),Object(f.jsx)("output",{name:"selected_year",id:"selected_year",children:this.state.year})]}),Object(f.jsx)("br",{}),Object(f.jsx)("div",{children:Object(f.jsx)("button",{onClick:this.setCurrentYear,children:"Show 2021 data"})}),Object(f.jsx)("div",{id:"ttip"}),Object(f.jsx)("svg",{id:"scatter",width:800,height:800,ref:this.svgRef})]})}}]),r}(n.Component),O=function(t){Object(u.a)(r,t);var e=Object(h.a)(r);function r(t){var n;return Object(s.a)(this,r),(n=e.call(this,t)).svgRef=a.a.createRef(),n.state={scene:0},n.setscene=n.setscene.bind(Object(l.a)(n)),n}return Object(o.a)(r,[{key:"setscene",value:function(){this.setState({scene:(this.state.scene+1)%3})}},{key:"render",value:function(){return 0==this.state.scene?Object(f.jsxs)("div",{children:[Object(f.jsx)("button",{onClick:this.setscene,children:"Change"}),Object(f.jsx)(j,{})]}):1==this.state.scene?Object(f.jsxs)("div",{children:[Object(f.jsx)("button",{onClick:this.setscene,children:"Change"}),Object(f.jsx)(v,{})]}):Object(f.jsxs)("div",{children:[Object(f.jsx)("button",{onClick:this.setscene,children:"Change"}),Object(f.jsx)(g,{})]})}}]),r}(n.Component);var _=function(){return Object(f.jsx)("div",{className:"App",children:Object(f.jsx)(O,{})})},x=function(t){t&&t instanceof Function&&r.e(3).then(r.bind(null,112)).then((function(e){var r=e.getCLS,n=e.getFID,a=e.getFCP,i=e.getLCP,c=e.getTTFB;r(t),n(t),a(t),i(t),c(t)}))};c.a.render(Object(f.jsx)(a.a.StrictMode,{children:Object(f.jsx)(_,{})}),document.getElementById("root")),x()}},[[111,1,2]]]);
//# sourceMappingURL=main.38872670.chunk.js.map